<%- include('../admin-layout/header.ejs') %>

  <!-- ?PROD Only: Google Tag Manager (noscript) (Default ThemeSelection: GTM-5DDHKGP, PixInvent: GTM-5J3LMKC) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5DDHKGP" height="0" width="0"
      style="display: none; visibility: hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  <!-- Layout wrapper -->
  <div class="layout-wrapper layout-content-navbar">
    <div class="layout-container">
      <!-- Menu -->

      <aside id="layout-menu" class="layout-menu menu-vertical menu bg-menu-theme">
        <div class="app-brand demo">
          <a href="index.html" class="app-brand-link">
            <!-- <span class="app-brand-logo demo me-1">
            <span style="color: var(--bs-primary)">
              <svg
                width="30"
                height="24"
                viewBox="0 0 250 196"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  fill-rule="evenodd"
                  clip-rule="evenodd"
                  d="M12.3002 1.25469L56.655 28.6432C59.0349 30.1128 60.4839 32.711 60.4839 35.5089V160.63C60.4839 163.468 58.9941 166.097 56.5603 167.553L12.2055 194.107C8.3836 196.395 3.43136 195.15 1.14435 191.327C0.395485 190.075 0 188.643 0 187.184V8.12039C0 3.66447 3.61061 0.0522461 8.06452 0.0522461C9.56056 0.0522461 11.0271 0.468577 12.3002 1.25469Z"
                  fill="currentColor"
                />
                <path
                  opacity="0.077704"
                  fill-rule="evenodd"
                  clip-rule="evenodd"
                  d="M0 65.2656L60.4839 99.9629V133.979L0 65.2656Z"
                  fill="black"
                />
                <path
                  opacity="0.077704"
                  fill-rule="evenodd"
                  clip-rule="evenodd"
                  d="M0 65.2656L60.4839 99.0795V119.859L0 65.2656Z"
                  fill="black"
                />
                <path
                  fill-rule="evenodd"
                  clip-rule="evenodd"
                  d="M237.71 1.22393L193.355 28.5207C190.97 29.9889 189.516 32.5905 189.516 35.3927V160.631C189.516 163.469 191.006 166.098 193.44 167.555L237.794 194.108C241.616 196.396 246.569 195.151 248.856 191.328C249.605 190.076 250 188.644 250 187.185V8.09597C250 3.64006 246.389 0.027832 241.935 0.027832C240.444 0.027832 238.981 0.441882 237.71 1.22393Z"
                  fill="currentColor"
                />
                <path
                  opacity="0.077704"
                  fill-rule="evenodd"
                  clip-rule="evenodd"
                  d="M250 65.2656L189.516 99.8897V135.006L250 65.2656Z"
                  fill="black"
                />
                <path
                  opacity="0.077704"
                  fill-rule="evenodd"
                  clip-rule="evenodd"
                  d="M250 65.2656L189.516 99.0497V120.886L250 65.2656Z"
                  fill="black"
                />
                <path
                  fill-rule="evenodd"
                  clip-rule="evenodd"
                  d="M12.2787 1.18923L125 70.3075V136.87L0 65.2465V8.06814C0 3.61223 3.61061 0 8.06452 0C9.552 0 11.0105 0.411583 12.2787 1.18923Z"
                  fill="currentColor"
                />
                <path
                  fill-rule="evenodd"
                  clip-rule="evenodd"
                  d="M12.2787 1.18923L125 70.3075V136.87L0 65.2465V8.06814C0 3.61223 3.61061 0 8.06452 0C9.552 0 11.0105 0.411583 12.2787 1.18923Z"
                  fill="white"
                  fill-opacity="0.15"
                />
                <path
                  fill-rule="evenodd"
                  clip-rule="evenodd"
                  d="M237.721 1.18923L125 70.3075V136.87L250 65.2465V8.06814C250 3.61223 246.389 0 241.935 0C240.448 0 238.99 0.411583 237.721 1.18923Z"
                  fill="currentColor"
                />
                <path
                  fill-rule="evenodd"
                  clip-rule="evenodd"
                  d="M237.721 1.18923L125 70.3075V136.87L250 65.2465V8.06814C250 3.61223 246.389 0 241.935 0C240.448 0 238.99 0.411583 237.721 1.18923Z"
                  fill="white"
                  fill-opacity="0.3"
                />
              </svg>
            </span>
          </span>
          <span class="app-brand-text demo menu-text fw-semibold ms-2"
            >Materio</span -->

            <img src="/assets/images/admin logo.png" alt="Furnspace Logo" width="105" height="50" />
          </a>

          <a href="javascript:void(0);" class="layout-menu-toggle menu-link text-large ms-auto">
            <i class="menu-toggle-icon d-xl-block align-middle"></i>
          </a>
        </div>

        <div class="menu-inner-shadow"></div>

        <ul class="menu-inner py-1">
          <!-- Dashboards -->

          <!-- Layouts -->

          <!-- Front Pages -->

          <!-- Apps & Pages -->

          <!-- e-commerce-app menu start -->
          <li class="menu-item active open">
            <a href="javascript:void(0);" class="menu-link menu-toggle">
              <i class="menu-icon tf-icons ri-shopping-bag-3-line"></i>
              <div data-i18n="eCommerce">eCommerce</div>
            </a>
            <ul class="menu-sub">
              <li class="menu-item">
                <a href="/admin/dashboard" class="menu-link">
                  <div data-i18n="Dashboard">Dashboard</div>
                </a>
              </li>
              <li class="menu-item">
                <a href="javascript:void(0);" class="menu-link menu-toggle">
                  <div data-i18n="Products">Products</div>
                </a>
                <ul class="menu-sub">
                  <li class="menu-item">
                    <a href="/admin/product-list" class="menu-link">
                      <div data-i18n="Product List">Product List</div>
                    </a>
                  </li>
                  <li class="menu-item">
                    <a href="/admin/add-product" class="menu-link">
                      <div data-i18n="Add Product">Add Product</div>
                    </a>
                  </li>
                  <li class="menu-item">
                    <a href="/admin/category-list" class="menu-link">
                      <div data-i18n="Category List">Category List</div>
                    </a>
                  </li>
                </ul>
              </li>
              <li class="menu-item">
                <a href="javascript:void(0);" class="menu-link menu-toggle">
                  <div data-i18n="Order">Order</div>
                </a>
                <ul class="menu-sub">
                  <li class="menu-item">
                    <a href="/admin/order-list" class="menu-link">
                      <div data-i18n="Order List">Order List</div>
                    </a>
                  </li>
                  <!-- <li class="menu-item">
                    <a href="/admin/order-details" class="menu-link">
                      <div data-i18n="Order Details">Order Details</div>
                    </a>
                  </li> -->
                </ul>
              </li>
              <li class="menu-item active open">
                <a href="javascript:void(0);" class="menu-link menu-toggle">
                  <div data-i18n="Customer">Customer</div>
                </a>
                <ul class="menu-sub">
                  <li class="menu-item active">
                    <a href="/admin/allCustomer" class="menu-link">
                      <div data-i18n="All Customers">All Customers</div>
                    </a>
                  </li>
                  <!-- <li class="menu-item">
                    <a href="javascript:void(0);" class="menu-link menu-toggle">
                      <div data-i18n="Customer Details">Customer Details</div>
                    </a>
                    <ul class="menu-sub">
                      <li class="menu-item">
                        <a href="app-ecommerce-customer-details-overview.html" class="menu-link">
                          <div data-i18n="Overview">Overview</div>
                        </a>
                      </li>
                      <li class="menu-item">
                        <a href="app-ecommerce-customer-details-security.html" class="menu-link">
                          <div data-i18n="Security">Security</div>
                        </a>
                      </li>
                      <li class="menu-item">
                        <a href="app-ecommerce-customer-details-billing.html" class="menu-link">
                          <div data-i18n="Address & Billing">
                            Address & Billing
                          </div>
                        </a>
                      </li>
                      <li class="menu-item">
                        <a href="app-ecommerce-customer-details-notifications.html" class="menu-link">
                          <div data-i18n="Notifications">Notifications</div>
                        </a>
                      </li>
                    </ul>
                  </li> -->
                </ul>
              </li>
              <li class="menu-item  ">
                <a href="javascript:void(0);" class="menu-link menu-toggle">
                  <div data-i18n="Coupon & Offer">Coupon & Offer</div>
                </a>
                <ul class="menu-sub">
                  <li class="menu-item">
                    <a href="/admin/add-coupon" class="menu-link">
                      <div data-i18n="Add coupon">Add coupon</div>
                    </a>
                  </li>
                  <li class="menu-item ">
                    <a href="/admin/list-coupon" class="menu-link">
                      <div data-i18n="Coupon List">Coupon List</div>
                    </a>
                  </li>
                  <li class="menu-item ">
                    <a href="/admin/add-offer" class="menu-link">
                      <div data-i18n="Add offer">Add offer</div>
                    </a>
                  </li>
                  <li class="menu-item ">
                    <a href="/admin/offer-list" class="menu-link">
                      <div data-i18n="offer List">offer List</div>
                    </a>
                  </li>
                </ul>
              </li>
              <li class="menu-item">
                <a href="app-ecommerce-manage-reviews.html" class="menu-link">
                  <div data-i18n="Manage Reviews">Manage Reviews</div>
                </a>
              </li>
              <li class="menu-item">
                <a href="app-ecommerce-referral.html" class="menu-link">
                  <div data-i18n="Referrals">Referrals</div>
                </a>
              </li>
              <li class="menu-item">
                <a href="javascript:void(0);" class="menu-link menu-toggle">
                  <div data-i18n="Settings">Settings</div>
                </a>
                <ul class="menu-sub">
                  <li class="menu-item">
                    <a href="app-ecommerce-settings-detail.html" class="menu-link">
                      <div data-i18n="Store Details">Store Details</div>
                    </a>
                  </li>
                  <li class="menu-item">
                    <a href="app-ecommerce-settings-payments.html" class="menu-link">
                      <div data-i18n="Payments">Payments</div>
                    </a>
                  </li>
                  <li class="menu-item">
                    <a href="app-ecommerce-settings-checkout.html" class="menu-link">
                      <div data-i18n="Checkout">Checkout</div>
                    </a>
                  </li>
                  <li class="menu-item">
                    <a href="app-ecommerce-settings-shipping.html" class="menu-link">
                      <div data-i18n="Shipping & Delivery">
                        Shipping & Delivery
                      </div>
                    </a>
                  </li>
                  <li class="menu-item">
                    <a href="app-ecommerce-settings-locations.html" class="menu-link">
                      <div data-i18n="Locations">Locations</div>
                    </a>
                  </li>
                  <li class="menu-item">
                    <a href="app-ecommerce-settings-notifications.html" class="menu-link">
                      <div data-i18n="Notifications">Notifications</div>
                    </a>
                  </li>
                </ul>
              </li>
            </ul>
          </li>
          <!-- e-commerce-app menu end -->
          <!-- Academy menu start -->

          <!-- Academy menu end -->

          <li class="menu-item">
            <a href="javascript:void(0);" class="menu-link menu-toggle">
              <i class="menu-icon tf-icons ri-bill-line"></i>
              <div data-i18n="Invoice">Invoice</div>
              <div class="badge bg-danger rounded-pill ms-auto"></div>
            </a>
            <ul class="menu-sub">
              <li class="menu-item">
                <a href="app-invoice-list.html" class="menu-link">
                  <div data-i18n="List">List</div>
                </a>
              </li>
              <li class="menu-item">
                <a href="app-invoice-preview.html" class="menu-link">
                  <div data-i18n="Preview">Preview</div>
                </a>
              </li>
              <li class="menu-item">
                <a href="app-invoice-edit.html" class="menu-link">
                  <div data-i18n="Edit">Edit</div>
                </a>
              </li>
              <li class="menu-item">
                <a href="app-invoice-add.html" class="menu-link">
                  <div data-i18n="Add">Add</div>
                </a>
              </li>
            </ul>
          </li>
          <li class="menu-item">
            <a href="javascript:void(0);" class="menu-link menu-toggle">
              <i class="menu-icon tf-icons ri-user-line"></i>
              <div data-i18n="Users">Users</div>
            </a>
            <ul class="menu-sub">
              <li class="menu-item">
                <a href="app-user-list.html" class="menu-link">
                  <div data-i18n="List">List</div>
                </a>
              </li>

              <li class="menu-item">
                <a href="javascript:void(0);" class="menu-link menu-toggle">
                  <div data-i18n="View">View</div>
                </a>
                <ul class="menu-sub">
                  <li class="menu-item">
                    <a href="app-user-view-account.html" class="menu-link">
                      <div data-i18n="Account">Account</div>
                    </a>
                  </li>
                  <li class="menu-item">
                    <a href="app-user-view-security.html" class="menu-link">
                      <div data-i18n="Security">Security</div>
                    </a>
                  </li>
                  <li class="menu-item">
                    <a href="app-user-view-billing.html" class="menu-link">
                      <div data-i18n="Billing & Plans">Billing & Plans</div>
                    </a>
                  </li>
                  <li class="menu-item">
                    <a href="app-user-view-notifications.html" class="menu-link">
                      <div data-i18n="Notifications">Notifications</div>
                    </a>
                  </li>
                  <li class="menu-item">
                    <a href="app-user-view-connections.html" class="menu-link">
                      <div data-i18n="Connections">Connections</div>
                    </a>
                  </li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
      </aside>
      <!-- / Menu -->

      <!-- Layout container -->
      <div class="layout-page">
        <!-- Navbar -->

        <nav
          class="layout-navbar container-xxl navbar navbar-expand-xl navbar-detached align-items-center bg-navbar-theme"
          id="layout-navbar">
          <div class="layout-menu-toggle navbar-nav align-items-xl-center me-4 me-xl-0 d-xl-none">
            <a class="nav-item nav-link px-0 me-xl-6" href="javascript:void(0)">
              <i class="ri-menu-fill ri-24px"></i>
            </a>
          </div>

          <div class="navbar-nav-right d-flex align-items-center" id="navbar-collapse">
            <!-- <nav aria-label="breadcrumb" class="breadcrumb-nav border-0 mb-0">
          <div class="container breadcrumbs">
            <ol class="breadcrumb">
              <% breadcrumbs.forEach(crumb => { %>
                <li class="breadcrumb-item">
                  <a href="<%= crumb.url %>"> <%= crumb.name %> </a>
                </li>
              <% }); %>
            </ol>
          </div>
        </nav> -->
            <!-- Search -->
            <!-- <div class="navbar-nav align-items-center">
            <div class="nav-item navbar-search-wrapper mb-0">
              <a
                class="nav-item nav-link search-toggler fw-normal px-0"
                href="javascript:void(0);"
              >
                <i class="ri-search-line ri-22px scaleX-n1-rtl me-1_5"></i>
                <span class="d-none d-md-inline-block text-muted ms-1_5"
                  >Search (Ctrl+/)</span
                >
              </a>
            </div>
          </div> -->
            <!-- /Search -->

            <ul class="navbar-nav flex-row align-items-center ms-auto">


              <!-- User -->
              <li class="nav-item navbar-dropdown dropdown-user dropdown">
                <a class="nav-link dropdown-toggle hide-arrow p-0" href="javascript:void(0);" data-bs-toggle="dropdown">
                  <div class="avatar avatar-online">
                    <img src="/dashboard-assets/img/avatars/1.png" alt class="w-px-40 h-auto rounded-circle" />
                  </div>
                </a>
                <ul class="dropdown-menu dropdown-menu-end mt-3 py-2">
                  <li>
                    <a class="dropdown-item" href="pages-account-settings-account.html">
                      <div class="d-flex align-items-center">
                        <div class="flex-shrink-0 me-2">
                          <div class="avatar avatar-online">
                            <img src="/dashboard-assets/img/avatars/1.png" alt class="w-px-40 h-auto rounded-circle">
                          </div>
                        </div>
                        <div class="flex-grow-1">
                          <h6 class="mb-0 small">
                            <%= isAdmin.name %>
                          </h6>
                          <small class="text-muted">Admin</small>

                        </div>
                      </div>
                    </a>
                  </li>
                  <li>
                    <div class="dropdown-divider"></div>
                  </li>
                  <li>
                    <a class="dropdown-item" href="/admin/admin-profile">
                      <i class="ri-user-3-line ri-22px me-2"></i>
                      <span class="align-middle">My Profile</span>
                    </a>
                  </li>

                  <li>
                    <div class="d-grid px-4 pt-2 pb-1">
                      <a class="btn btn-danger d-flex" href="/admin">
                        <small class="align-middle">Logout</small>
                        <i class="ri-logout-box-r-line ms-2 ri-16px"></i>
                      </a>
                    </div>
                  </li>
                </ul>
          </div>

          <!-- Search Small Screens -->
          <div class="navbar-search-wrapper search-input-wrapper d-none">
            <input type="text" class="form-control search-input container-xxl border-0" placeholder="Search..."
              aria-label="Search..." />
            <i class="ri-close-fill search-toggler cursor-pointer"></i>
          </div>
        </nav>

        <!-- / Navbar -->

        <!-- Content wrapper -->
        <div class="content-wrapper">
          <!-- Content -->

          <div class="container-xxl flex-grow-1 container-p-y">
            <!-- customers List Table -->
            <div class="card">
              <div class="card-datatable table-responsive">
                <div id="DataTables_Table_0_wrapper" class="dataTables_wrapper dt-bootstrap5 no-footer">
                  <div class="card-header d-flex rounded-0 flex-wrap pb-md-0 pt-0">
                    <div class="me-5 pe-5">
                      <form method="GET" action="/admin/allCustomer">
                        <div class="input-group mb-3 mt-3">
                          <input type="text" class="form-control" name="search" value="<%= search %>"
                            placeholder="Search user...">
                          <button class="btn btn-outline-light" type="submit">Search</button>
                        </div>
                      </form>
                    </div>
                    <div class="d-flex justify-content-start justify-content-md-end align-items-baseline">
                      <div
                        class="dt-action-buttons d-flex align-items-start align-items-md-center justify-content-sm-center gap-4 pt-0">
                        <div class="dataTables_length my-0" id="DataTables_Table_0_length">

                        </div>
                        <div class="dt-buttons btn-group flex-wrap d-flex">
                          <div class="btn-group">
                            <!-- <button
                            class="btn btn-secondary buttons-collection dropdown-toggle btn-outline-secondary me-4 waves-effect waves-light"
                            tabindex="0"
                            aria-controls="DataTables_Table_0"
                            type="button"
                            aria-haspopup="dialog"
                            aria-expanded="false"
                          >
                            <span
                              ><i class="ri-upload-2-line ri-16px me-1"></i>
                              <span class="d-none d-sm-inline-block"
                                >Export</span
                              ></span
                            >
                          </button> -->
                          </div>

                        </div>
                      </div>
                    </div>
                  </div>


                  <table class="datatables-customers table dataTable no-footer dtr-column" id="DataTables_Table_0"
                    aria-describedby="DataTables_Table_0_info" style="width: 1043px;">
                    <thead>
                      <tr>
                        <th class="sorting_disabled dt-checkboxes-cell dt-checkboxes-select-all" rowspan="1" colspan="1"
                          style="width: 18px;" data-col="1" aria-label="">

                        </th>
                        <th class="" tabindex="0" colspan="1" style="width: 200px;">Name</th>
                        <th class="" tabindex="0" colspan="1" style="width: 118px;">E mail</th>
                        <th></th>
                        <th></th>
                        <th class="" tabindex="0" aria-controls="DataTables_Table_0" rowspan="1" colspan="1"
                          style="width: 205px;" aria-label="Country: activate to sort column ascending">Phone</th>
                        <th class="" tabindex="0" aria-controls="DataTables_Table_0" rowspan="1" colspan="1"
                          style="width: 62px;" aria-label="Order: activate to sort column ascending">Status</th>
                        <th></th>
                        <th></th>
                        <th class="text-nowrap " tabindex="0" aria-controls="DataTables_Table_0" rowspan="1" colspan="1"
                          style="width: 114px;" aria-label="Total Spent: activate to sort column ascending">Action</th>
                      </tr>
                    </thead>
                    <tbody>
                      <% customers.forEach(function(customer, index) { %>
                        <tr class="odd" id="row-<%= customer._id %>">
                          <td class="dt-checkboxes-cell">

                          </td>
                          <td class="sorting_1">
                            <div class="d-flex justify-content-start align-items-center customer-name">
                              <div class="d-flex flex-column">
                                <a href="app-ecommerce-customer-details-overview.html" class="text-heading">
                                  <span class="fw-medium text-truncate">
                                    <%= customer.name %>
                                  </span>
                                </a>
                              </div>
                            </div>
                          </td>
                          <td><span class="text-heading fw-medium text-truncate">
                              <%= customer.email %>
                            </span></td>
                          <td></td>
                          <td></td>
                          <td>
                            <div
                              class="d-flex justify-content-start align-items-center customer-country fw-medium text-truncate">
                              <div><span>
                                  <% if(customer.phone){ %>
                                    <%= customer.phone %>
                                      <% }else{ %>
                                        N/A
                                        <% } %>
                                </span></div>
                            </div>
                          </td>
                          <td>
                            <span class="status-label fw-medium text-truncate">
                              <%= customer.isListed==='true' ? 'Active' : 'InActive' %>
                            </span>
                          </td>
                          <td></td>
                          <td></td>
                          <td>
                            <button
                              class="btn btn-primary btn-sm btn-icon btn-text-secondary waves-effect waves-light rounded-pill mx-2"
                              onclick="populateCustomerModal({ _id: '<%= customer._id %>', name: '<%= customer.name %>', email: '<%= customer.email %>', phone: '<%= customer.phone %>', status: '<%= customer.isListed %>' })">
                              <i class="ri-edit-box-line ri-22px"></i>
                            </button>
                          </td>
                        </tr>
                        <% }); %>
                    </tbody>
                  </table>


                  <!-- Modal for editing customer -->
                  <div class="modal fade" id="editCustomerModal" tabindex="-1" aria-labelledby="editCustomerModalLabel"
                    aria-hidden="true">
                    <div class="modal-dialog">
                      <div class="modal-content">
                        <div class="modal-header">
                          <h5 class="modal-title" id="editCustomerModalLabel">Edit Customer</h5>
                          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                          <form id="editCustomerForm" onsubmit="return validateForm()">
                            <input type="hidden" id="customer-id">
                            <div class="mb-3">
                              <label for="edit-name" class="form-label">Customer Name</label>
                              <input type="text" class="form-control" id="edit-name" required readonly>
                              <div class="invalid-feedback" id="nameError">Please enter a valid name.</div>
                            </div>
                            <div class="mb-3">
                              <label for="edit-email" class="form-label">Email</label>
                              <input type="email" class="form-control" id="edit-email" required readonly>
                              <div class="invalid-feedback" id="emailError">Please enter a valid email.</div>
                            </div>
                            <div class="mb-3">
                              <label for="edit-phone" class="form-label">Phone No</label>
                              <input type="text" class="form-control" id="edit-phone" required readonly>
                              <div class="invalid-feedback" id="phoneError">Please enter a valid phone number.</div>
                            </div>
                            <div class="mb-3">
                              <label for="edit-status" class="form-label">Status</label>
                              <select class="form-select" id="edit-status">
                                <option value="">Select Status</option>
                                <option value="true">Active</option>
                                <option value="false">Inactive</option>
                              </select>
                              <div class="invalid-feedback" id="statusError">Please select a status.</div>
                            </div>
                            <button type="submit" class="btn btn-primary" id="saveCustomerButton">Save Changes</button>
                          </form>
                        </div>
                      </div>
                    </div>
                  </div>



                  <!-- Pagination controls -->
                  <nav aria-label="Page navigation">
                    <ul class="pagination justify-content-center">
                      <li class="page-item <%= currentPage === 1 ? 'disabled' : '' %>">
                        <a class="page-link page-link-prev" href="?page=<%= currentPage - 1 %>&search=<%= search %>"
                          aria-label="Previous" tabindex="-1" aria-disabled="<%= currentPage === 1 %>">
                          <span aria-hidden="true"><i class="icon-long-arrow-left"></i></span> Prev
                        </a>
                      </li>
                      <% for (let i=1; i <=totalPages; i++) { %>
                        <li class="page-item <%= currentPage === i ? 'active' : '' %>">
                          <a class="page-link" href="?page=<%= i %>&search=<%= search %>">
                            <%= i %>
                          </a>
                        </li>
                        <% } %>
                          <li class="page-item <%= currentPage === totalPages ? 'disabled' : '' %>">
                            <a class="page-link page-link-next" href="?page=<%= currentPage + 1 %>&search=<%= search %>"
                              aria-label="Next">
                              Next <span aria-hidden="true"><i class="icon-long-arrow-right"></i></span>
                            </a>
                          </li>
                    </ul>
                  </nav>


                  <div class="col-sm-12 col-md-6">

                  </div>
                </div>
                <div style="width: 1%"></div>
              </div>
            </div>



          </div>
        </div>


        <div class="content-backdrop fade"></div>
      </div>
      <!-- Content wrapper -->
    </div>
    <!-- / Layout page -->
  </div>

  <!-- Overlay -->
  <div class="layout-overlay layout-menu-toggle"></div>

  <!-- Drag Target Area To SlideIn Menu On Small Screens -->
  <div class="drag-target"></div>
  </div>
  <!-- / Layout wrapper -->







  <!--Bootstrap links-->
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <!-- Bootstrap JS -->
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>


  <!-- Core JS -->
  <!-- build:js assets/vendor/js/core.js -->
  <script src="/dashboard-assets/vendor/libs/jquery/jquery.js"></script>
  <script src="/dashboard-assets/vendor/libs/popper/popper.js"></script>
  <script src="/dashboard-assets/vendor/js/bootstrap.js"></script>
  <script src="/dashboard-assets/vendor/libs/node-waves/node-waves.js"></script>
  <script src="/dashboard-assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>
  <script src="/dashboard-assets/vendor/libs/hammer/hammer.js"></script>
  <script src="/dashboard-assets/vendor/libs/i18n/i18n.js"></script>
  <script src="/dashboard-assets/vendor/libs/typeahead-js/typeahead.js"></script>
  <script src="/dashboard-assets/vendor/js/menu.js"></script>

  <!-- endbuild -->

  <!-- Vendors JS -->
  <script src="/dashboard-assets/vendor/libs/moment/moment.js"></script>
  <script src="/dashboard-assets/vendor/libs/datatables-bs5/datatables-bootstrap5.js"></script>
  <script src="/dashboard-assets/vendor/libs/select2/select2.js"></script>
  <script src="/dashboard-assets/vendor/libs/%40form-validation/popular.js"></script>
  <script src="/dashboard-assets/vendor/libs/%40form-validation/bootstrap5.js"></script>
  <script src="/dashboard-assets/vendor/libs/%40form-validation/auto-focus.js"></script>
  <script src="/dashboard-assets/vendor/libs/cleavejs/cleave.js"></script>
  <script src="/dashboard-assets/vendor/libs/cleavejs/cleave-phone.js"></script>

  <!-- Main JS -->
  <script src="/dashboard-assets/js/main.js"></script>

  <!-- Page JS -->
  <!-- <script src="/dashboard-assets/js/app-ecommerce-customer-all.js"></script> -->



  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>



  <script>
    function validateForm() {
      let isValid = true;

      const name = document.getElementById('edit-name').value.trim();
      const email = document.getElementById('edit-email').value.trim();
      const phone = document.getElementById('edit-phone').value.trim();
      const status = document.getElementById('edit-status').value.trim();

      const namePattern = /^[a-zA-Z\s]+$/;
      const phonePattern = /^[1-9][0-9]{9}$/;
      const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

      if (!name.match(namePattern) || name.startsWith(' ')) {
        isValid = false;
        document.getElementById('nameError').style.display = 'block';
      } else {
        document.getElementById('nameError').style.display = 'none';
      }

      if (!email.match(emailPattern)) {
        isValid = false;
        document.getElementById('emailError').style.display = 'block';
      } else {
        document.getElementById('emailError').style.display = 'none';
      }

      if (!phone.match(phonePattern) || phone.startsWith(' ') || phone.startsWith('0')) {
        isValid = false;
        document.getElementById('phoneError').style.display = 'block';
      } else {
        document.getElementById('phoneError').style.display = 'none';
      }

      if (status === '') {
        isValid = false;
        document.getElementById('statusError').style.display = 'block';
      } else {
        document.getElementById('statusError').style.display = 'none';
      }

      return isValid;
    }
  </script>

  <script>

    let originalCustomerData = {};

    document.getElementById('saveCustomerButton').addEventListener('click', saveChanges);

    function populateCustomerModal(customer) {
      document.getElementById('customer-id').value = customer._id;
      document.getElementById('edit-name').value = customer.name;
      document.getElementById('edit-email').value = customer.email;
      document.getElementById('edit-phone').value = customer.phone;
      document.getElementById('edit-status').value = customer.isListed === 'true' ? 'Active' : 'InActive';

      // Store original data
      originalCustomerData = {
        name: customer.name,
        email: customer.email,
        phone: customer.phone,
        status: customer.isListed
      };

      // Show the modal
      new bootstrap.Modal(document.getElementById('editCustomerModal')).show();
    }

    function hasChanges() {
      const form = document.getElementById('editCustomerForm');
      const currentName = form.querySelector('#edit-name').value;
      const currentEmail = form.querySelector('#edit-email').value;
      const currentPhone = form.querySelector('#edit-phone').value;
      const currentStatus = form.querySelector('#edit-status').value;

      return originalCustomerData.name !== currentName ||
        originalCustomerData.email !== currentEmail ||
        originalCustomerData.phone !== currentPhone ||
        originalCustomerData.status !== currentStatus;
    }


    function saveChanges() {
      if (validateForm()) {
        if (!hasChanges()) {
          Swal.fire({
            title: 'No Changes Detected',
            text: 'No changes were made to the customer.',
            icon: 'info',
            confirmButtonText: 'OK'
          });
          return;
        }

        const form = document.getElementById('editCustomerForm');
        const customerId = document.getElementById('customer-id').value;
        const payload = {
          name: form.querySelector('#edit-name').value,
          email: form.querySelector('#edit-email').value,
          phone: form.querySelector('#edit-phone').value,
          isListed: form.querySelector('#edit-status').value
        };

        fetch(`/admin/allCustomer/${customerId}`, {
          method: 'PATCH',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(payload)
        })
          .then(response => {
            if (!response.ok) {
              throw new Error(`Server responded with status ${response.status}`);
            }
            return response.json();
          })
          .then(data => {
            if (data.success) {
              Swal.fire({
                title: 'Success',
                text: data.message || 'Customer updated successfully',
                icon: 'success',
                confirmButtonText: 'OK'
              }).then(() => {
                location.reload();
              });
            } else {
              Swal.fire({
                title: 'Error',
                text: 'Error updating customer: ' + (data.message || 'Unknown error'),
                icon: 'error',
                confirmButtonText: 'OK'
              });
            }
          })
          .catch(error => {
            console.error('Error:', error);
            Swal.fire({
              title: 'Error',
              text: 'Error updating customer: ' + error.message,
              icon: 'error',
              confirmButtonText: 'OK'
            });
          });
      }
    }

  </script>



  <script>
    function searchTable() {
      // Get the value of the search input
      let input = document.getElementById('searchInput');
      let filter = input.value.toLowerCase();
      // Get the table and its rows
      let table = document.getElementById('DataTables_Table_0');
      let tr = table.getElementsByTagName('tr');

      // Loop through all table rows (except the first row which contains the headers)
      for (let i = 1; i < tr.length; i++) {
        let td = tr[i].getElementsByTagName('td');
        let found = false;
        // Loop through all table cells in the current row
        for (let j = 0; j < td.length; j++) {
          if (td[j]) {
            // If the cell contains the search query, mark the row as found
            if (td[j].innerText.toLowerCase().indexOf(filter) > -1) {
              found = true;
              break;
            }
          }
        }
        // Show or hide the row based on whether the search query was found
        tr[i].style.display = found ? '' : 'none';
      }
    }
  </script>








  <%- include('../admin-layout/footer.ejs') %>

    <!-- Mirrored from demos.themeselection.com/materio-bootstrap-html-admin-template/html/vertical-menu-template/app-ecommerce-customer-all.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 25 Jun 2024 05:50:34 GMT -->

    <!-- beautify ignore:end -->